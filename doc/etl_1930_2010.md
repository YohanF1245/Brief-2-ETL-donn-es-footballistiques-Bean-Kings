# Documentation du nettoyage pour 2014
üîπ PARTIE 1 ‚Äî Pr√©paration et fusion des donn√©es

Script : etl_1930_2010.py
(Merge de sources CSV et enrichissement des donn√©es)

1. Chargement des sources

Deux fichiers CSV sont charg√©s :

r√©sultats des matchs (1930‚Äì2010)

dates et heures officielles des matchs


```py
df = pd.read_csv(input_file)
df_datetime = pd.read_csv(datetime_file, encoding="latin1")
```

2. Filtrage des matchs non pertinents

Suppression des matchs pr√©liminaires

Exclusion de l‚Äô√©dition 2014
```py
df = df[
    (~df["round"].str.contains("PRELIMINARY", case=False, na=False)) &
    (~df["edition"].astype(str).str.contains("2014", na=False))
]
```

3. Normalisation des phases de comp√©tition

Les valeurs h√©t√©rog√®nes de round sont regroup√©es sous des libell√©s standards.
```py
df["round"] = df["round"].str.strip().str.upper()

df.loc[df["round"].str.contains("GROUP_STAGE"), "round"] = "group stage"
df.loc[df["round"].str.contains("1/8|FIRST"), "round"] = "round of 16"
df.loc[df["round"].str.contains("FINAL"), "round"] = "final"
```
4. Nettoyage des noms d‚Äô√©quipes

Suppression des annotations parasites

Harmonisation des noms historiques
```py
df["team1"] = df["team1"].str.replace(r"\s*\(.*\)", "", regex=True)
df["team2"] = df["team2"].str.replace(r"\s*\(.*\)", "", regex=True)

df["team1"] = df["team1"].replace(regex={r"(?i)^frg$": "West Germany"})
df["team2"] = df["team2"].replace(regex={r"(?i)^gdr$": "East Germany"})
```
5. Gestion des matchs rejou√©s (Replay)

D√©tection des doublons et cr√©ation d‚Äôun indicateur Replay.
```py
df["Replay"] = "0"
duplicates = df.duplicated(
    subset=["edition", "round", "team1", "team2"],
    keep="first"
)
df.loc[duplicates, "Replay"] = "1"
```
6. R√©cup√©ration des dates et heures de match

Jointure logique avec le fichier datetime, bas√©e sur :

ann√©e

phase

√©quipes

indicateur replay
```py
df["Match Date"], df["Match Time"] = zip(
    *df.apply(lambda r: get_match_date(r, df_datetime), axis=1)
)
```
7. Normalisation des villes (venue)

```py
def city_to_english(city):
    return unidecode(city).lower().strip()

df["venue"] = df["venue"].apply(city_to_english)
```
8. Sortie de la PARTIE 1

Le DataFrame issu de ce script :

contient toutes les informations fusionn√©es

est coh√©rent historiquement

est pr√™t pour un nettoyage avanc√©
```py
def load_and_clean_data():
    return df
```

visuel
```py
  df["year"] = pd.to_datetime(df["edition"], errors="coerce").dt.year
         edition              round               score           team1              team2                               url       venue  year Replay Match Date Match Time
0   1930-URUGUAY        group stage           4-1 (3-0)          France             Mexico     1930_URUGUAY_FS.htm#1-WC-30-I  montevideo   NaN      0  7/13/1930      15:00
1   1930-URUGUAY        group stage           3-0 (2-0)   United States            Belgium    1930_URUGUAY_FS.htm#13-WC-30-I  montevideo   NaN      0  7/13/1930      15:00
2   1930-URUGUAY        group stage           2-1 (2-0)      Yugoslavia             Brazil     1930_URUGUAY_FS.htm#7-WC-30-I  montevideo   NaN      0  7/14/1930      12:45
3   1930-URUGUAY        group stage           3-1 (1-0)         Romania               Peru    1930_URUGUAY_FS.htm#10-WC-30-I  montevideo   NaN      0  7/14/1930      14:50
4   1930-URUGUAY        group stage           1-0 (0-0)       Argentina             France     1930_URUGUAY_FS.htm#2-WC-30-I  montevideo   NaN      0  7/15/1930      16:00
5   1930-URUGUAY        group stage           3-0 (1-0)           Chile             Mexico     1930_URUGUAY_FS.htm#3-WC-30-I  montevideo   NaN      0  7/16/1930      14:45
6   1930-URUGUAY        group stage           4-0 (0-0)      Yugoslavia            Bolivia     1930_URUGUAY_FS.htm#8-WC-30-I  montevideo   NaN      0  7/17/1930      12:45
7   1930-URUGUAY        group stage           3-0 (2-0)   United States           Paraguay    1930_URUGUAY_FS.htm#14-WC-30-I  montevideo   NaN      0  7/17/1930      14:45
8   1930-URUGUAY        group stage           1-0 (0-0)         Uruguay               Peru    1930_URUGUAY_FS.htm#11-WC-30-I  montevideo   NaN      0  7/18/1930      14:30
9   1930-URUGUAY        group stage           1-0 (0-0)           Chile             France     1930_URUGUAY_FS.htm#4-WC-30-I  montevideo   NaN      0  7/19/1930      12:50
10  1930-URUGUAY        group stage           6-3 (3-1)       Argentina             Mexico     1930_URUGUAY_FS.htm#5-WC-30-I  montevideo   NaN      0  7/19/1930      15:00
11  1930-URUGUAY        group stage           4-0 (1-0)          Brazil            Bolivia     1930_URUGUAY_FS.htm#9-WC-30-I  montevideo   NaN      0  7/20/1930      13:00
12  1930-URUGUAY        group stage           1-0 (1-0)        Paraguay            Belgium    1930_URUGUAY_FS.htm#15-WC-30-I  montevideo   NaN      0  7/20/1930      15:00
```

üîπ PARTIE 2 ‚Äî Nettoyage, standardisation et r√®gles m√©tier

Script : etl_clean_1930_2010.py
(Application des r√®gles ETL et pr√©paration du dataset final)

1. Chargement du DataFrame pr√©par√©

Le DataFrame de la PARTIE 1 est r√©utilis√© directement.
```py
from etl_1930_2010 import load_and_clean_data

df_etl = load_and_clean_data()
```
2. S√©curisation des dates et cr√©ation du timestamp

```py
df_etl["Match Date"] = pd.to_datetime(df_etl["Match Date"], errors="coerce")
df_etl["Match Time"] = pd.to_datetime(
    df_etl["Match Time"], errors="coerce"
).dt.time

df_etl["Datetime"] = pd.to_datetime(
    df_etl["Match Date"].astype(str) + " " +
    df_etl["Match Time"].astype(str),
    errors="coerce"
)
```
3. Normalisation des phases (round)

Application d‚Äôun mapping standardis√©.

```py
df_etl["round"] = df_etl["round"].apply(normalize_round)
```

4. Normalisation des villes et √©quipes

```py
df_etl["venue"] = df_etl["venue"].apply(normalize_city)
df_etl["team1"] = df_etl["team1"].apply(normalize_text)
df_etl["team2"] = df_etl["team2"].apply(normalize_text)
```
5. S√©curisation des buts

Si n√©cessaire, extraction depuis la colonne score.

```py
goals = df_etl["score"].str.extract(r"(\d+)-(\d+)")
df_etl["Home Team Goals"] = goals[0].astype("Int64")
df_etl["Away Team Goals"] = goals[1].astype("Int64")
```

6. Calcul des r√©sultats

```py
df_etl["Home Result"] = df_etl.apply(compute_home_result, axis=1)
df_etl["Away Result"] = df_etl.apply(compute_away_result, axis=1)
```
7. S√©lection et renommage des colonnes finales

```py
df_final = df_etl[list(FINAL_COLUMNS.keys())].rename(
    columns=FINAL_COLUMNS
)
```
8. Sortie finale

‚úî Dataset propre et homog√®ne
‚úî Align√© avec les r√®gles ETL
‚úî Compatible avec l‚Äô√©dition 2014

```py
print(df_final.head())
```
```py
                Datetime                     Stage            City Home Team Name  Home Team Goals  Away Team Goals Away Team Name Home Result Away Result
0    1930-07-13 15:00:00                     group      montevideo         france                4                1         mexico      winner       loser
1    1930-07-13 15:00:00                     group      montevideo  united states                3                0        belgium      winner       loser
2    1930-07-14 12:45:00                     group      montevideo     yugoslavia                2                1         brazil      winner       loser
0    1930-07-13 15:00:00                     group      montevideo         france                4                1         mexico      winner       loser
1    1930-07-13 15:00:00                     group      montevideo  united states                3                0        belgium      winner       loser
0    1930-07-13 15:00:00                     group      montevideo         france                4                1         mexico      winner       loser
1    1930-07-13 15:00:00                     group      montevideo  united states                3                0        belgium      winner       loser
0    1930-07-13 15:00:00                     group      montevideo         france                4                1         mexico      winner       loser
0    1930-07-13 15:00:00                     group      montevideo         france                4                1         mexico      winner       loser
1    1930-07-13 15:00:00                     group      montevideo  united states                3                0        belgium      winner       loser
0    1930-07-13 15:00:00                     group      montevideo         france                4                1         mexico      winner       loser
0    1930-07-13 15:00:00                     group      montevideo         france                4                1         mexico      winner       loser
0    1930-07-13 15:00:00                     group      montevideo         france                4                1         mexico      winner       loser
0    1930-07-13 15:00:00                     group      montevideo         france                4                1         mexico      winner       loser
0    1930-07-13 15:00:00                     group      montevideo         france                4                1         mexico      winner       loser
0    1930-07-13 15:00:00                     group      montevideo         france                4                1         mexico      winner       loser
1    1930-07-13 15:00:00                     group      montevideo  united states                3                0        belgium      winner       loser
2    1930-07-14 12:45:00                     group      montevideo     yugoslavia                2                1         brazil      winner       loser
```